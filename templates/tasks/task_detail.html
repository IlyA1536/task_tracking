{% extends "base.html" %}
{% block content %}
{% load custom_tags %}
{% load i18n %}
    <ul class="list-group py-2">
        <li class="list-group-item active fs-2" aria-current="true">{{ task.title }}</li>
        <li class="list-group-item fs-4">{{ task.status }}</li>
        <li class="list-group-item fs-4">{{ task.priority }}</li>
        <li class="list-group-item fs-4">{{ task.description }}</li>
        <li class="list-group-item fs-4">{{ task.due_date }}</li>
        <li class="list-group-item fs-4">{{ task.creator }}</li>
    </ul>

    <div class="btn-group" role="group" aria-label="Basic example">

        <button type="button" class="btn btn-primary"><a href="{% url 'tasks:task-update' task.id %}" class="link-light">{% trans "Update" %}</a></button>
    </div>

    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
    {% trans "Delete" %}
    </button>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">{% trans 'Delete task' %}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% trans "Are you sure you want to delete this task?" %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <form method="post" action="{% url 'tasks:task-delete' task.id %}">
                    {% csrf_token %}
                    <input type="submit" value="{% trans 'Delete' %}">
                </form>
            </div>
            </div>
        </div>
    </div>

    <form method="post" action="{% url 'tasks:task-detail' task.pk %}" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">{% trans "Add comment" %}</button>
    </form>
    {% for comment in task.comments.all %}
        {{ comment.author.username }}
        <br>
        {% if comment.media %}
            {% if comment.media.url|endswith:".jpg" or comment.media.url|endswith:".jpeg" or comment.media.url|endswith:".png" or comment.media.url|endswith:".avif"%}
                <img src="{{ comment.media.url }}" alt="A comment image" style="max-width: 320px;">
            {% elif comment.media.url|endswith:".mp4" %}
                <video width="480" height="380" controls>
                    <source src="{{ comment.media.url }}" type="video/mp4">
                </video>
            {% else %}
                <a href="{{ comment.media.url }}">{% trans "Download file" %}</a>
            {% endif %}
        {% endif %}
        <br>
        {{ comment.content }}
        <br>
        {{ comment.created_at }}
        <br><br>
    {% endfor %}
{% endblock %}
